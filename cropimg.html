<!DOCTYPE html>
<html>
<head>
    <!-- <script src="./cropimg.js"></script> -->

</head>
<body>
    <script>
        var testJSON={
    "responses": [
            {
        "name" : "test",
        "x": 0,
        "y" : 0,
        "width":100,
        "height":200,
    },
    {
        "name" : "test2",
        "x" : 1,
        "y" : 2,
        "width":100,
        "height":200,
    }
    ],

};

    </script>
    <div class="content">
        <div class="before">
          <h>before</h>
          <div>
            <canvas id="bCanvas"></canvas>
            <img src="./sign_small.jpg">

          </div>
        </div>
        <div class="after">
          <h>after</h>
          <div class="aDiv" id="aDiv">
            <canvas id="acanvas"></canvas>


          </div>
        </div>
      </div>


</body>
            <script>
            function cropp(){

                //json 접근
                const temp = testJSON.responses;
                console.log(temp.length);
        
                //user 선택한 idx에 따라 바뀜
                idx = 1;
                var x = temp[idx].x;
                var y = temp[idx].y;
                var w = temp[idx].width;
                var h = temp[idx].height;
        
                console.log(x,y);
                var canvas = document.getElementById("acanvas");
                
                var img = new Image();
                img.src = "./sign_small.jpg";

                img.onload = function(){
                    var context = canvas.getContext("2d");
                    context.drawImage(img,x,y,w,h);
                }

                
            }
            cropp();
            function upload(){
                const canvas = document.getElementById("acanvas");
                const imgBase64 = canvas.toDataURL('image/jpg','image/octet-stream');
                const decodImg = atob(imgBase64.split(',')[1]);

                let array=[];
                for(let i = 0; i< decodImg.length;i++){
                    array.push(decodImg.charCodeAt(i));
                }

                const file = new Blob([new Uint8Array(array)], {type:'image/jpeg'});
                const fileName = 'img_'+new Date().getMilliseconds()+'.jpg';
                let formData = new FormData();
                formData.append('file',file,fileName);
               
                axios({
                    method : "post",
                    url : "https://domain/api/cropimage/",
                    data : formData
                    })
                    .then(response=>{
                        console.log(response);
                    })
                    .catch(error=>{
                        console.log(error);
                    })
            }
            upload();
        </script>

</html>